
name: Java CI with Maven

on:
  workflow_dispatch:
    inputs:
      deploy_message:
        description: 'Deployment message'
        required: true
        default: 'Run appium tests'

jobs:
  build:
    runs-on: macos-latest
    strategy:
      matrix:
        api-level: [30]  
        target: [default]
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        npm install -g appium

    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8

    - uses: actions/setup-node@v2
      with:
       node-version: '20'
    - run: |
            npm install -g appium@v1.20.2
            appium -v
            appium &>/dev/null &

    - name: Run Appium Tests
      uses: reactivecircus/android-emulator-runner@v1
      with:
        api-level: 33
        arch: x86_64
        profile: Pixel XL
        disable-animations: true
        emulator-options: -no-window -gpu swiftshader_indirect -noaudio -no-boot-anim -camera-back none
        script: pytest --html=report.html --self-contained-html
